<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>快速排序算法 &mdash; Algviz</title><link rel="stylesheet" href="https://algviz.com/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://algviz.com/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://algviz.com/assets/css/globals/common.min.css"><link rel="stylesheet" href="https://algviz.com/assets/css/globals/responsive.min.css"><link rel="stylesheet" href="https://algviz.com/assets/css/posts/index.min.css"><link rel="stylesheet" href="https://algviz.com/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://algviz.com/assets/css/pages/index.min.css"><link rel="canonical" href="https://algviz.com/cn/QuickSort/"><link rel="alternate" type="application/atom+xml" title="Algviz" href="https://algviz.com/feed.xml"><link rel="shortcut icon" href="https://algviz.com/favicon.ico"><meta property="og:title" content="快速排序算法"><meta name="keywords" content="算法可视化 Python 数据结构 动画演示"><meta name="og:keywords" content="算法可视化 Python 数据结构 动画演示"><meta name="description" content="快速排序算法最早由东尼·霍尔提出，又称分区交换排序算法，简称快排算法。快排算法在一般情况下的执行效率较高，在实际工程中有着广泛的应用。"><meta name="og:description" content="快速排序算法最早由东尼·霍尔提出，又称分区交换排序算法，简称快排算法。快排算法在一般情况下的执行效率较高，在实际工程中有着广泛的应用。"><meta property="og:url" content="https://algviz.com/cn/QuickSort/"><meta property="og:site_name" content="Algviz"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2022-10-13"> <script src="https://algviz.com/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://algviz.com/assets/js/jquery-ui.min.js"></script> <script src="https://algviz.com/assets/js/main.min.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"> <span> <a href="https://algviz.com/" title="Algviz"> <img class="header-logo" src="https://algviz.com/assets/img/logo.svg" alt="algviz.com"> </a> </span><nav class="site-header-nav" style="display:inline-flex" role="navigation"> <a href="https://algviz.com/index.html" class=" site-header-nav-item" target="" title="主页">主页</a> <a href="https://algviz.com/cn/about.html" class=" site-header-nav-item" target="" title="关于">关于</a> <a href="https://algviz.com/cn/index.html" class=" site-header-nav-item" target="" title="博客">博客</a> <a href="https://algviz.com/en/QuickSort/" class="site-header-nav-item"><img src="/assets/img/flag-us.svg" class="site-header-nav-flag"></a></nav></div></header><link rel="stylesheet" href="https://algviz.com/assets/css/globals/base16.monokai.min.css"> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script> MathJax = { tex: { inlineMath: [['$', '$']], processEscapes: true } }; </script><section class="collection-head small geopattern" data-pattern-id="快速排序算法"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">快速排序算法</h1><div class="collection-info"> <span class="meta-info" style="padding-right:3px"> <span class="octicon octicon-calendar"></span> 2022/10/13 </span> <span class="meta-info" style="padding-right:3px"> <span class="octicon octicon-file-directory"></span> <a href="https://algviz.com/cn/categories.html#排序算法" title="排序算法">排序算法</a> </span> <span class="meta-info" style="padding-right:3px"> <span class="octicon octicon-file-directory"></span> <a href="https://algviz.com/cn/categories.html#递归" title="递归">递归</a> </span> <span class="meta-info" style="padding-right:3px"> <span class="octicon octicon-clock"></span> 共 2745 字，约 8 分钟 </span></div></div></div></div></div></section><br><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p>快速排序算法最早由东尼·霍尔提出，又称<strong>分区交换排序</strong>算法，简称快排算法。快排算法在一般情况下的执行效率较高，在实际工程中有着广泛的应用。</p><h2 id="算法思想">算法思想</h2><p>快排算法使用了<strong>分治</strong>的思想，这一点和<a href="https://algviz.com/cn/MergeSort/">归并排序算法</a>类似，不过快排算法使用了一种十分巧妙的方式来对子序列进行划分，而不是像归并排序算法那样简单的将序列从中间对半分开。 <strong>快排算法将序列划分为左右两段，并保证左侧序列中最大的元素小于右侧序列中最小的元素。</strong>为了实现这一点，快排算法从当前序列中挑选一个元素作为<strong>基数</strong>，并以基数为基准对序列进行分割，在分割时算法保证基数左边的子序列都小于基数，而基数右边的子序列都大于或等于基数。</p><h2 id="算法实现">算法实现</h2><h3 id="子序列分割">子序列分割</h3><p>下面的动画展示了子序列的分割过程：</p><p>这里我们选取序列中<strong>最右侧</strong>的元素作为基数，并按照从左向右的顺序依次将序列中的元素和基数进行比较，同时记录序列中的当前分割位置（<em>对应动画中的箭头 P</em>）。如果当前元素小于基数，则将当前元素和分割位置处的元素进行交换，并将分割位置右移一位。<strong>最后，不要忘了将当前分割位置处的元素和基数进行交换！</strong>这样我们就可以保证分割位置左侧的所有元素值都小于基数，而分割位置及其右侧的所有元素值都大于或等于基数。</p><p><img src="/assets/svgs/QuickSort_partition.svg" alt="QuickSort_partition.svg" /></p><h3 id="快排算法完整实现">快排算法完整实现</h3><p>实现了子序列的分割，就算是完成了快排算法的核心逻辑，剩下只需要递归的调用自己对分割后的子序列进行快速排序，直到子序列中只剩下一个元素（基本情况）。</p><p>下面的代码是带动画可视化的 Python 版本实现：</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">algviz</span>

<span class="k">class</span> <span class="nc">QuickSort</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nums_</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">viz</span> <span class="o">=</span> <span class="n">algviz</span><span class="p">.</span><span class="n">Visualizer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">nums</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">createVector</span><span class="p">(</span><span class="n">nums_</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Numbers'</span><span class="p">,</span> <span class="n">cell_size</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span> <span class="n">histogram</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">algviz</span><span class="p">.</span><span class="n">RecursiveTree</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">createCursor</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'P'</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">]</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums_</span><span class="p">));</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;=</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># 基本情况：序列中只有一个元素。
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="n">forward</span><span class="p">(</span><span class="s">'{}:{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_gray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_gray</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">),</span> <span class="n">hold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">;</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">()</span>
        <span class="c1"># 子序列分割代码开始。
</span>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">[</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_orange</span><span class="p">,</span> <span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_tomato</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_silver</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_orange</span><span class="p">,</span> <span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_lime</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">()</span>
                <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">mark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_silver</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">viz</span><span class="p">.</span><span class="n">display</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="c1"># 子序列分割代码结束。
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">removeMark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_gray</span><span class="p">);</span> <span class="bp">self</span><span class="p">.</span><span class="n">nums</span><span class="p">.</span><span class="n">removeMark</span><span class="p">(</span><span class="n">algviz</span><span class="p">.</span><span class="n">color_silver</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">index</span><span class="p">())</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tree</span><span class="p">.</span><span class="n">backward</span><span class="p">()</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">QuickSort</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div></div><p><em>您可以在本地安装 algviz 后直接运行该代码片段！环境配置请参考：<a href="https://algviz.com/cn/about.html#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4">安装步骤</a></em></p><h2 id="动画演示">动画演示</h2><p>动画中包括两个数据结构：<a href="https://algviz.com/cn/RecursiveTree/">递归树</a>（Recursive tree）和排序数组（Numbers）。</p><ul><li>递归树显示算法当前的递归状态：<ul><li>新产生的子问题使用<font color="#ADFF2F">黄绿色</font>标记；</li><li>已解决的子问题使用<font color="silver">银灰色</font>标记；</li><li>而当前正在处理的子问题使用<font color="tomato">番茄红色</font>标记。</li></ul></li><li>排序数组是输入的排序序列：<ul><li>基数元素使用<font color="orange">橙色</font>标记；</li><li>当前比基数小的元素使用<font color="lime">亮绿色</font>标记；</li><li>当前比基数大的元素使用<font color="tomato">番茄红色</font>标记；</li><li>当前正在处理的数组区间以外的元素使用<font color="gray">深灰色</font>淡化；</li><li>当前数组的划分位置使用光标 P 来表示。</li></ul></li></ul><p><img src="/assets/svgs/QuickSort.svg" alt="QuickSort.svg" /></p><h2 id="算法特点">算法特点</h2><p>快排算法在一般情况下的时间效率是很高的，而且快排算法可以直接在原始输入序列上进行操作，对储存空间的需求也比归并排序少很多，因此对大规模序列进行排序时有很大优势。但由于<strong>快排算法是不稳定的</strong>（即：不能保证大小相等的两个元素的相对位置和输入序列中的一样），所以在对稳定性有要求的场景中不能使用该算法。</p><h3 id="时间复杂度">时间复杂度</h3><p>使用递归树来分析快排算法的时间复杂度：在递归树的每一层中，分割子序列所需要的操作加起来为 $O(n)$ ，但由于<strong>子序列的划分不一定是左右平衡的，这与基数的选择有关</strong>，所以递归树的深度是不确定的。如果我们足够幸运，在每次的划分时左右两个子序列的长度都刚好是相等的，那么递归树的深度就是 $O(log_2^n)$，但如果我们非常倒霉，每次划分时其中一个子序列的长度都为 1，那么递归树的深度就是 $O(n)$。</p><p>因此，快排算法的时间复杂度在 $O(n \cdot log_2^n)$ ~ $O(n^2)$ 之间。幸运的是，实际情况中的序列往往是趋于离散且均匀分布的，如果我们<strong>随机的选择基数进行划分</strong>，那么递归树大概率是平衡的，所以在实际应用中快排算法的时间复杂度接近于 $O(n \cdot log_2^n)$。</p><h3 id="空间复杂度">空间复杂度</h3><p>子序列的划分过程可以在输入序列上直接完成，不需要申请额外的储存空间，因此快速排序算法的空间复杂度只与递归树的深度有关。在时间复杂度的分析中，我们知道递归树的深度在 $O(log_2^n)$ ~ $O(n)$ 之间，因此快排算法的空间复杂度也是在 $O(log_2^n)$ ~ $O(n)$ 之间。</p><br><div class="article-license"><p>本文遵守<a href="https://creativecommons.org/licenses/by-nd/2.0/"> Attribution-NoDerivs 2.0 Generic</a>许可协议。 <img src="/assets/img/license.png" alt="Attribution-NoDerivs 2.0 Generic"></p></div></article></div><div class="column one-fourth"><h3>搜索：</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://algviz.com/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://algviz.com/assets/search_data.json?v=1666874441', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 5, fuzzy: false, exclude: ['algviz'] }) </script><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://algviz.com/assets/js/jquery.toc.min.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2022 <span title="zjl9959@gmail.com">zjl9959@gmail.com</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">顶部</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >顶部</a></li></ul><ul class="site-footer-links mobile-hidden"><li> <a href="https://algviz.com/index.html" title="主页" target="">主页</a></li><li> <a href="https://algviz.com/cn/about.html" title="关于" target="">关于</a></li><li> <a href="https://algviz.com/cn/index.html" title="博客" target="">博客</a></li><li><a href="https://algviz.com/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="顶部"><span class="octicon octicon-arrow-up"></span></a></div></body></html>
